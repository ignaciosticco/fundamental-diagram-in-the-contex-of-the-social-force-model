\section{\label{results}Results}

\subsection{\label{fundamental_diagram} Fundamental diagram in the original model}

In Fig~\ref{fundamental_diagram_flow}, we show the fundamental diagram (density vs. flow) for different corridor widths. We can distinguish the two typical branches of the fundamental diagram. In the free flow branch ($\rho < 5$), the flow increases linearly with the density, since there are no collisions between pedestrians. In this regime, pedestrians achieve the desired velocity, leading to a flow that grows linearly with the density. That is reason why the flow takes the value of $J \sim \rho$ until $\rho=5$. This behavior applies to all the corridor width analyzed. 

On the other hand we have the congested branch  for $\rho > 5$. Here we face two different scenarios:

\begin{itemize}
\item i) In narrow corridors (say $w < 10$) we can see that the flow reduces as the density increases. This resembles the traditional behavior of the fundamental diagram reported in the literature. 
\item ii) In wide corridors (say $w > 15$) we see that the flow increases with density. This contradicts the typical behavior of the fundamental diagram.   
\end{itemize}

We wonder what is the reason that determines the increase or decrease of the flow in the congested branch. Since the trajectories of pedestrians are straight (there are no crossing path that could reduce the flow), we can assert that the the friction force is the only factor in the flow reduction. The inset of the Fig.~\ref{fundamental_diagram_flow} corresponds to the empirical measures of Helbing et al. at the entrance of the Jamaraat bridge (the corridor with was $w=22$~m ). Notice that our simulated result corresponding to a $w=22$~m corridor, exhibit a different behavior in the congested branch. In the simulated case, the flow increases even for the greatest densities. On the contrary, the empirical measurement exhibit a flow reduction for $\rho > 5$ and it reaches a plateau for the highest density values.  

In order to satisfy the fundamental diagram reported in the literature, It is necessary that the flow at the maximum density ($\rho_{max} = 9$) be less than the flow at $\rho = 5$. That is:  $J(\rho = 9) < J(\rho = 5)$. From the flow definition in Eq.~\ref{ec-flow} we can derive

\begin{align*} 
v(\rho_{max}) &< \frac{5v_d}{\rho_{max}} \\
v(\rho_{max}) &< \frac{5}{9} v_d
\end{align*}

As our desired velocity is fixed $v_d = 1$~m/s, we conclude that the speed at the maximum density has to be bounded by $v(\rho_{max}) \lesssim  0.5$~m/s in order to satisfy the qualitative behavior of the fundamental diagram reported in the literature.

The above reasoning is consistent with the speed-density results shown in Fig.~\ref{fundamental_diagram_speed}.As a visual guide we plotted $v=0.5$~m/s with a dashed line. Pay attention to the speed values in $\rho_{max} = 9$. The values corresponding to the wider corridors ($w=15$~m and $w=22$~m) both exceed $v=0.5$~m/s. Otherwise, the values corresponding to narrower corridors fall below $v=0.5$~m/s. 

\begin{figure}[htbp!]
\includegraphics[width=\columnwidth]
{plots/flow-density_vd1_multiple_widths.eps}
\caption{\label{fundamental_diagram_flow} Flow as a function of the density for different widths. Initially, 
pedestrians were randomly distributed along the corridor. The measurements were taken in the middle
of the corridor once the system reached the stationary state. The length of the corridor 
was 28~m in all cases with periodic boundary conditions in the x direction.}
\end{figure}

The plots in Fig.\ref{fundamental_diagram_speed} support the fact that when the density is low enough, pedestrians manage to walk at the desired velocity ($v=1$~m/s). Only for $\rho>5$ the velocity begins the slow down proses. The inset shows the measurements at the entrance of the Jamaraat bridge. When comparing our results with the measurements of the Jamaraat bridge, it must be pointed out that the latter do not show a constant velocity for lower densities. We attribute this difference to the fact that in the real system, the pedestrian path are more complex when the density low. Another interesting finding here is that the wider the corridor, the greater the velocity for all the density values. In Section \ref{velocity_profile} we will further discuss this topic.

\begin{figure}[htbp!]
\includegraphics[width=\columnwidth]
{plots/speed-density_vd1_multiple_widths.eps}
\caption{\label{fundamental_diagram_speed} Speed as a function of the density for different widths. Initially, 
pedestrians were randomly distributed along the corridor. The measurements were taken in the middle
of the corridor once the system reached the stationary state. The length of the corridor 
was 28~m in all cases with periodic boundary conditions in the x direction.}
\end{figure}

\subsection{\label{velocity_profile} Velocity profile}

 As we mentioned in Section \ref{fundamental_diagram}, when the density is low, pedestrians achieve the desired velocity ($v=v_d=1$~m/s). Since this result is only valid for the area located in the middle of the corridor, we want to shed some light and understand what is happening in the entire corridor. In Fig.~\ref{speed-profile-w22} we show the velocity profile (velocity vs. y-location) of the pedestrians in the  corridor. We can see that low-density situations lead to a cruising velocity profile $v=v_d$. This is valid for every location in the corridor (not only the center as was previously discussed). For higher densities, the velocity profile turns into to a parabola-like function that resembles the typical velocity profile under conditions of the laminar flow in a viscous fluid, where the velocity increases toward the center of a tube. In our case, pedestrians near near the walls are the one with the lower velocity. The velocity increases when moving away from the wall until it reaches the maximum in the center of the corridor. This behavior suggests that the friction that the wall exerts on pedestrians, is playing a fundamental role in the velocity distribution. We did some simulations removing the walls and adding periodic boundary conditions in the y-coordinate. This yield to constant-cruising speed profiles for all the densities, confirming that the walls are a necessary condition in order to produce a parabola-shaped speed profile.

\begin{figure}[htbp!]
\includegraphics[width=\columnwidth]
{plots/v(y)_width22_k24.eps}
\caption{\label{speed-profile-w22} Velocity profile (velocity vs y-position) for different densities (see legend for the corresponding densities). The simulated corridor was 28~m lenght. Pedestrians walk from left to right with periodic boundary condition in the x-direction. Initially, pedestrians were randomly distributed, the corridor width was $w = 22~m$ in all the cases. }
\end{figure}

In Fig.~\ref{speed-profile-multi_width} we show the velocity profile for different widths. The x-axis of the plot corresponds to the y-location normalized by the width of the corridor. The density chosen was $\rho = 6$ since we wanted to study a situation in which pedestrians collide with each other, remember that when $\rho<5$ pedestrians manage to avoid collisions. We can see the parabola shape in which lower velocities are located in the areas near the walls. There is a clear dependence of $v_{max}$ and the corridor width. It is interesting that the wider the corridor, the higher the maximum velocity value reached. The inset of the figure shows the same data normalized by the maximum speed value correspondent to each corridor width. Notice that once normalized, all the data follow the same pattern. This suggests that regardless the scale of the corridor, the speed profile exhibit a fundamental behavior. This means that, the velocity growth rate from the wall towards the center of the corridor, is the same regardless of the size of the corridor

\begin{figure}[htbp!]
\includegraphics[width=\columnwidth]
{plots/v(y)_multi_width.eps}
\caption{\label{speed-profile-multi_width} Velocity profile (velocity vs y-position) for different corridors width (see legend for the corresponding widths). The simulated corridor was 28~m length. Pedestrians walk from left to right with periodic boundary condition in the x-direction. Initially, pedestrians were randomly distributed, the density was $\rho = 6$ in all the cases. The inset shows the same data with velocity normalized by the maximum value corresponding to each dataset. }
\end{figure}


\subsection{Work done by friction force}


We have shown how the velocity takes different values along the corridor. We also analyzed the work done by the friction between pedestrians in the corridor. The work exerted was numerically calculated for each pedestrian with the Simpson rule. The integration step was $\Delta t = 0.05$~s. Once all the pedestrians had its work calculated, we proceed to create a squared grid in the corridor. The cells were 1~m length, and we associated the work on the pedestrians to the cell where they were placed.  In Fig.~\ref{abswg} we show three heat maps of the absolute value of the work done by the pedestrian-pedestrian friction force. The axis represent the x location and y location of the corridor. The heat map denotes higher work for red color and lower work for the blue color. The walls are located at $y=0$ and $y=w$ (bottom and top of each figure). Fig.~\ref{abswg_width10} corresponds to a 10 m width corridor, Fig.~\ref{abswg_width15} corresponds to a 15 m width corridor and  Fig.~\ref{abswg_width10} corresponds to a 22 m width corridor.

In the three figures we observe the same pattern: the regions near the walls (bottom and top) are the regions in which pedestrians suffer the higher work done by the friction. In the center of the corridor the work is reduced in all the cases. Another interesting observation is that the work seems to increase with the corridor width. This happens because in the wide corridors the relative velocity between pedestrians is greater. See Fig.~\ref{speed-profile-multi_width} and compare the slopes between the parabolas. It can be seen that the wider the corridor, the greater the slope (corresponding to locations near the wall). As it is stated in Eq.(\ref{granular}), the friction force depends on the compression and the relative velocity among pedestrians. The differences between Figs.~\ref{abswg_width10}, \ref{abswg_width15} and  \ref{abswg_width22}  are only explained by the increment of the relative velocity. The compression levels remain the same in the three cases since the compression only depends on the density (which is fix at $\rho=6$ for the three figures).

% this gives the full picture of whats going on with the velocity profile...  the interaction pedestrian-wall is friction interaction that excerts the higest friction, since the wall acts like a steady pedestrian. The pedestrian interacting with the wall fells a downward draging force.... ver explicacion vieja.. 

\begin{figure}[htbp!]
        \centering
        \begin{subfigure}[b]{0.475\columnwidth}
            \centering
            \caption{}
            \includegraphics[width=\textwidth]{plots/abswg_width10.eps}
 
            \label{abswg_width10}
        \end{subfigure}
        %\hfill
        \begin{subfigure}[b]{0.475\columnwidth}  
            \centering
            \caption{} 
            \includegraphics[width=\textwidth]{plots/abswg_width15.eps}
            
            \label{abswg_width15}
        \end{subfigure}
        %\vskip\baselineskip
        \begin{subfigure}[b]{0.475\columnwidth}   
            \centering 
            \caption{}            
            \includegraphics[width=\textwidth]{plots/abswg_width22.eps}
        
            \label{abswg_width22}
           \end{subfigure}        
 \caption{} 
 \label{abswg}

\end{figure}


\subsection{Friction modification}

As already mentioned, the results shown so far indicate that friction may be the key to improving the fundamental diagram. We want to make clear that improving the fundamental diagram means obtaining the congested branch reported by different authors, in particular in the Jamaraat study of Helbing et al. where the congested branch reaches a plateau in a 22~m width corridor. The original version of the Social Force Model proposes the same friction coefficient for the pedestrian-pedestrian interaction and the pedestrian-wall interaction. The value proposed was $\kappa = 2.4\times10^{4}$. This value is widely used by the pedestrian dynamics community despite it lacks a rigorous foundation. 

We tested how the system reacts to the modification of the friction value. Fig.~\ref{fgmodified-w22} shows the flow vs density for different friction values. The triangles correspond to the increment of the wall friction in one order of magnitude (now $\kappa_w = 2.4\times10^{5}$). In this case we left the pedestrian-pedestrian friction unchanged. We can see that the flow reduces a little bit, but this is not enough to produce the negative slope that characterizes the congested regime. 

The circles correspond to a modification of the friction between pedestrians without changing the value of the wall friction. We increased the pedestrian-pedestrian friction by a factor of ten ($\kappa_i = 2.4\times10^{5}$). Here we see a significant reduction of the flow. The qualitative behavior resembles the fundamental diagram reported by Helbing et al. with a well defined congested branch for the greatest densities.

We also tested the case were both friction coefficients are ten times the value of the original model (now $\kappa_w = \kappa_i = 2.4\times10^{5}$). The squared symbols represent this scenario. As expected, the flow reduces significantly respect the original case (cross symbol plot). Interestingly, the reduction of the flow is more than the reduction due to the increment of $\kappa_i$ plus the reduction of the flow due to $\kappa_w$. This behavior is indicative that the superposition principle does not hold in this system. This phenomena is explained by the non-linearity of the equation of motion.   

This finding allows us to affirm that the friction plays a crucial role in the functional behavior of the fundamental diagram. The increment of both individual-individual friction and wall friction are determinant in order to achieve a congested branch. Other authors attain the congested branch modifying different aspects of the model. Parisi et al. impose zero desired velocity once pedestrians are close enough~\ref{parisi1}, Johannson increases the relaxation time in order to slow down the net-time headway~\ref{johannson} and more recently, Kwak et al.\ref{kwak} induce the jamming transition by an attraction. Our results show that the empirical behavior for the fundamental diagram can be achieved by properly increasing the friction coefficients. In appendix we discuss about how the modification of the relaxation time and the increment of the friction coefficient yield the same effect, since they affect the same term in the reduced-in-units equation of motion.  

We argue that in real scenarios, a combination of all these factors may be the cause of the marked flow reduction that portray the fundamental diagram. The pedestrian's path can be very complex even if it is a simple enclosure (straight corridor) and the target is well defined (unidirectional flow). Beyond the complexities given by the internal motivations of pedestrians, we strongly suggest studying and modeling coefficients of friction between individuals and friction with the walls. These two parameters have shown to be very important in the dynamics and deserve a closer inspection in future research. 


\begin{figure}[htbp!]
\includegraphics[width=\columnwidth]
{plots/flow-density_pasillo22m_fgmodified_multi.eps}
\caption{\label{fgmodified-w22} Fundamental diagram (flow vs density) for different friction coefficient (see legend for the corresponding values). The simulated corridor was 28~m length. Pedestrians walk from left to right with periodic boundary condition in the x-direction. Initially, pedestrians were randomly distributed. For each density we measure the flow once the system reaches the stationary state.}
\end{figure}


\subsection{\label{clusters}Clusters}

Cluster formation is a very important process in pedestrian dynamics. Moreover, is the key process that explains the clogging phenomena in bottleneck evacuations. We analyzed the clustering formation according to the granular cluster definition given in~\ref{dorso2}
In Fig.~\ref{cluster_distribution} we show the histogram of the cluster size distribution for three different densities: $\rho=4.5$, $\rho=5$ and $\rho=5.5$ from top to bottom.   
For each density we studied two situations. The cluster size distribution for the original parameters of the Social Force Model (left hand side plots) and the cluster size distribution corresponding to the increment of the friction coefficients by a factor of ten(right hand side plots).

We found intriguing results, incrementing the density produces bigger size clusters until it reaches a critical value in which the size distribution shifts to a bimodal distribution (compare \ref{size_distribution_w22_density5} with \ref{size_distribution_w22_density5_5} and \ref{size_distribution_w22_density4.5_kx10} with \ref{size_distribution_w22_density5_kx10}). Once this phenomena takes place, the there are only to possibilities for the clusters: either there are many small sized clusters or there is only one giant cluster. We can see that this phenomena   



\begin{figure}[htbp!]
        \centering
        \begin{subfigure}[b]{0.475\columnwidth}
            \centering
            \caption{}
            \includegraphics[width=\textwidth]{plots/size_distribution_w22_density4_5.eps}
 
            \label{size_distribution_w22_density4.5}
        \end{subfigure}
        %\hfill
        \begin{subfigure}[b]{0.475\columnwidth}  
            \centering
            \caption{} 
            \includegraphics[width=\textwidth]{plots/size_distribution_w22_density4_5_kx10.eps}
            
            \label{size_distribution_w22_density4.5_kx10}
        \end{subfigure}
        %\vskip\baselineskip
        \begin{subfigure}[b]{0.475\columnwidth}   
            \centering 
            \caption{}            
            \includegraphics[width=\textwidth]{plots/size_distribution_w22_density5.eps}
        
            \label{size_distribution_w22_density5}
           \end{subfigure}      
        \begin{subfigure}[b]{0.475\columnwidth}
            \centering
            \caption{}
            \includegraphics[width=\textwidth]{plots/size_distribution_w22_density5_kx10.eps}
 
            \label{size_distribution_w22_density5_kx10}
        \end{subfigure}
        %\hfill
        \begin{subfigure}[b]{0.475\columnwidth}  
            \centering
            \caption{} 
            \includegraphics[width=\textwidth]{plots/size_distribution_w22_density5_5.eps}
            
            \label{size_distribution_w22_density5_5}
        \end{subfigure}
        %\vskip\baselineskip
        \begin{subfigure}[b]{0.475\columnwidth}   
            \centering 
            \caption{}            
            \includegraphics[width=\textwidth]{plots/size_distribution_w22_density5_5_kx10.eps}
        
            \label{size_distribution_w22_density5_5_kx10}
           \end{subfigure}     
 \caption{bin sizes are 1, 50 and 50 } 
 \label{cluster_distribution}

\end{figure}




